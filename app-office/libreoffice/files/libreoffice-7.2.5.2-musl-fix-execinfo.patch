From 1ceea1e405fd375e38b69f842324ed97913e09a0 Mon Sep 17 00:00:00 2001
From: Jory Pratt <anarchy@gentoo.org>
Date: Thu, 3 Feb 2022 18:33:46 -0600
Subject: [PATCH] musl fix execinfo

---
 sal/osl/unx/backtrace.c | 2 +-
 sal/osl/unx/backtrace.h | 2 +-
 sal/osl/unx/signal.cxx  | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/sal/osl/unx/backtrace.c b/sal/osl/unx/backtrace.c
index 26005f771..01215c648 100644
--- a/sal/osl/unx/backtrace.c
+++ b/sal/osl/unx/backtrace.c
@@ -212,7 +212,7 @@ void backtrace_symbols_fd( void **buffer, int size, int fd )
     }
 }
 
-#elif !defined LINUX && !defined MACOSX && !defined IOS
+#elif !defined (__GLIBC__) && !defined MACOSX && !defined IOS
 
 int backtrace( void **buffer, int max_frames )
 {
diff --git a/sal/osl/unx/backtrace.h b/sal/osl/unx/backtrace.h
index 5fafc1c90..408c12c69 100644
--- a/sal/osl/unx/backtrace.h
+++ b/sal/osl/unx/backtrace.h
@@ -20,7 +20,7 @@
 #ifndef INCLUDED_SAL_OSL_UNX_BACKTRACE_H
 #define INCLUDED_SAL_OSL_UNX_BACKTRACE_H
 
-#if defined (LINUX)
+#if defined (LINUX) && defined (__GLIBC__)
 
 #include <execinfo.h>
 
diff --git a/sal/osl/unx/signal.cxx b/sal/osl/unx/signal.cxx
index 79721def6..95c07bd20 100644
--- a/sal/osl/unx/signal.cxx
+++ b/sal/osl/unx/signal.cxx
@@ -36,7 +36,7 @@
 
 #endif /* MACOSX */
 
-#ifdef LINUX
+#if defined(LINUX) && defined(__GLIBC__)
 #include <execinfo.h>
 #include <link.h>
 #define INCLUDE_BACKTRACE
-- 
2.34.1

